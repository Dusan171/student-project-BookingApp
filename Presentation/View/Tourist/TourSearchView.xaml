<UserControl x:Class="BookingApp.Presentation.View.Tourist.TourSearchView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:BookingApp.Presentation.ViewModel.Tourist"
             xmlns:util="clr-namespace:BookingApp.Utilities"
             Loaded="OnLoaded" Unloaded="OnUnloaded">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <util:GreaterThanZeroConverter x:Key="GreaterThanZeroConverter"/>
        <util:InverseBooleanConverter x:Key="InverseBooleanConverter"/>

        <!-- Custom styles for modern look -->
        <Style x:Key="SearchTextBoxStyle" TargetType="TextBox">
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                          Padding="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="#2E86C1"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SearchButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#2E86C1"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1F5F8B"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#1A4F7A"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#BDC3C7"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ReserveTourButtonStyle" TargetType="Button">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{Binding ReserveButtonColor}" 
                                CornerRadius="4" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.8"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid Background="#F8F9FA">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="320"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Search Panel -->
        <Border Grid.Column="0" Background="White" Margin="15,15,8,15" CornerRadius="8" 
                BorderBrush="#E0E0E0" BorderThickness="1">
            <!-- Dodajemo ScrollViewer za ceo search panel -->
            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                <StackPanel>
                    <!-- Header -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <Rectangle Width="16" Height="16" Fill="#2E86C1" Margin="0,0,8,0"/>
                        <TextBlock Text="PRETRAGA TURA" FontSize="16" FontWeight="Bold" Foreground="#2C3E50"/>
                    </StackPanel>

                    <TextBlock Text="Pronađite idealnu turu za vas!" 
                               FontSize="12" Foreground="#7F8C8D" Margin="0,0,0,20" TextWrapping="Wrap"/>

                    <!-- Search Fields - kompaktnije -->
                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Grad:" FontWeight="SemiBold" Margin="0,0,0,4" FontSize="12" Foreground="#34495E"/>
                        <TextBox Text="{Binding SearchCity, UpdateSourceTrigger=PropertyChanged}" 
                                 Style="{StaticResource SearchTextBoxStyle}"/>
                    </StackPanel>

                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Država:" FontWeight="SemiBold" Margin="0,0,0,4" FontSize="12" Foreground="#34495E"/>
                        <TextBox Text="{Binding SearchCountry, UpdateSourceTrigger=PropertyChanged}" 
                                 Style="{StaticResource SearchTextBoxStyle}"/>
                    </StackPanel>

                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Trajanje (sati):" FontWeight="SemiBold" Margin="0,0,0,4" FontSize="12" Foreground="#34495E"/>
                        <TextBox Text="{Binding SearchDuration, UpdateSourceTrigger=PropertyChanged}" 
                                 Style="{StaticResource SearchTextBoxStyle}"/>
                    </StackPanel>

                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Broj ljudi:" FontWeight="SemiBold" Margin="0,0,0,4" FontSize="12" Foreground="#34495E"/>
                        <TextBox Text="{Binding SearchPeopleCount, UpdateSourceTrigger=PropertyChanged}" 
                                 Style="{StaticResource SearchTextBoxStyle}"/>
                    </StackPanel>

                    <StackPanel Margin="0,0,0,20">
                        <TextBlock Text="Jezik:" FontWeight="SemiBold" Margin="0,0,0,4" FontSize="12" Foreground="#34495E"/>
                        <ComboBox ItemsSource="{Binding Languages}" 
                                  SelectedItem="{Binding SearchLanguage}"
                                  Height="35" FontSize="13" 
                                  BorderBrush="#E0E0E0" Background="White"/>
                    </StackPanel>

                    <!-- Buttons -->
                    <StackPanel>
                        <Button Command="{Binding SearchToursCommand}" 
                                Content="PRETRAŽI TURE" 
                                Style="{StaticResource SearchButtonStyle}"
                                Margin="0,0,0,8"
                                IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}"/>

                        <Button Command="{Binding ClearSearchCommand}" 
                                Content="Obriši pretragu" 
                                Background="#95A5A6" 
                                Foreground="White"
                                FontSize="12" 
                                Height="32" 
                                BorderThickness="0"
                                Margin="0,0,0,10"/>
                    </StackPanel>

                    <!-- Status -->
                    <TextBlock Text="{Binding StatusMessage}" 
                               FontSize="11" Foreground="#7F8C8D" 
                               TextWrapping="Wrap" Margin="0,10,0,0"/>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- Results Panel -->
        <Border Grid.Column="1" Background="White" Margin="8,15,15,15" CornerRadius="8" 
                BorderBrush="#E0E0E0" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Results Header -->
                <Border Grid.Row="0" Background="#F8F9FA" Padding="20,15" 
                        CornerRadius="8,8,0,0" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                    <StackPanel Orientation="Horizontal">
                        <Rectangle Width="16" Height="16" Fill="#27AE60" Margin="0,0,8,0"/>
                        <TextBlock Text="REZULTATI PRETRAGE" FontSize="16" FontWeight="Bold" 
                                   Foreground="#2C3E50" VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding Tours.Count, StringFormat=' ({0} tura)'}" 
                                   FontSize="13" Foreground="#7F8C8D" 
                                   VerticalAlignment="Center" Margin="5,0,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Loading Indicator -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" 
                            VerticalAlignment="Center"
                            Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <TextBlock Text="Učitavanje..." FontSize="16" Foreground="#7F8C8D"/>
                </StackPanel>

                <!-- Tours List -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="15" 
                              Visibility="{Binding IsLoading, Converter={StaticResource InverseBooleanConverter}}">
                    <ItemsControl ItemsSource="{Binding Tours}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="White" BorderBrush="#E8E8E8" BorderThickness="1" 
                                        Margin="0,0,0,12" Padding="15" CornerRadius="6">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="{Binding Name}" FontWeight="Bold" FontSize="15" Foreground="#2C3E50" Margin="0,0,0,6"/>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                                <Rectangle Width="12" Height="12" Fill="#E74C3C" Margin="0,0,4,0"/>
                                                <TextBlock Text="{Binding LocationText}" FontSize="12" Foreground="#7F8C8D"/>
                                                <Rectangle Width="12" Height="12" Fill="#3498DB" Margin="12,0,4,0"/>
                                                <TextBlock Text="{Binding DurationText}" FontSize="12" Foreground="#7F8C8D"/>
                                                <Rectangle Width="12" Height="12" Fill="#27AE60" Margin="12,0,4,0"/>
                                                <TextBlock Text="{Binding Language}" FontSize="12" Foreground="#7F8C8D"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                                                <Rectangle Width="12" Height="12" Fill="#F39C12" Margin="0,0,4,0"/>
                                                <TextBlock Text="{Binding AvailableSpotsText}" FontSize="12" FontWeight="SemiBold" Foreground="{Binding AvailableSpotsColor}"/>
                                            </StackPanel>
                                            <TextBlock Text="{Binding Description}" FontSize="11" Foreground="#95A5A6" TextWrapping="Wrap" MaxWidth="450" Margin="0,0,0,6"/>
                                            <TextBlock Text="{Binding GuideName, StringFormat='Vodič: {0}'}" FontSize="11" Foreground="#7F8C8D" FontStyle="Italic"/>
                                        </StackPanel>

                                        <Button Grid.Column="1" Command="{Binding DataContext.ReserveTourCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                CommandParameter="{Binding}" Style="{StaticResource ReserveTourButtonStyle}"
                                                VerticalAlignment="Center">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock FontSize="12" FontWeight="Bold">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Text" Value="REZERVIŠI"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding CanReserve}" Value="False">
                                                                    <Setter Property="Text" Value="POPUNJENO"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </StackPanel>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</UserControl>