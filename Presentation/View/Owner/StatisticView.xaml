<UserControl x:Class="BookingApp.Presentation.View.Owner.StatisticView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:utilities="clr-namespace:BookingApp.Utilities"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1400"
             Background="White"
             KeyboardNavigation.TabNavigation="Local">

    <UserControl.Resources>

        <!-- Card Style -->
        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="10"/>
        </Style>

        <!-- Centered Title Style -->
        <Style x:Key="CenteredTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,0,20"/>
        </Style>

        <!-- Section Title Style -->
        <Style x:Key="SectionTitleStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
        </Style>

        <!-- Info Text Style -->
        <Style x:Key="InfoTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,5,0,5"/>
        </Style>

        <!-- Keyboard Accessible Button Style -->
        <Style x:Key="AccessibleButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="15,10"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="KeyboardNavigation.IsTabStop" Value="True"/>
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#1e40af" Offset="0"/>
                        <GradientStop Color="#3b82f6" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#4A90E2"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Keyboard Accessible ComboBox Style -->
        <Style x:Key="AccessibleComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Height" Value="35"/>
            <Setter Property="KeyboardNavigation.IsTabStop" Value="True"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#4A90E2"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Keyboard Accessible DataGrid Style -->
        <Style x:Key="AccessibleDataGridStyle" TargetType="DataGrid">
            <Setter Property="KeyboardNavigation.IsTabStop" Value="True"/>
            <Setter Property="KeyboardNavigation.TabNavigation" Value="Local"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#4A90E2"/>
                    <Setter Property="BorderThickness" Value="2"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="40,40,40,20" KeyboardNavigation.TabNavigation="Local">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="500"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Accommodation Selection -->
            <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                <StackPanel KeyboardNavigation.TabNavigation="Local">
                    <TextBlock Text="Select accommodation to view statistics" 
                           FontSize="16" 
                           FontWeight="Medium"
                           Foreground="#2C3E50"
                           HorizontalAlignment="Left"
                           Margin="0,0,0,15"/>

                    <!-- Show Button - above table -->
                    <Button Content="Show" 
                        Foreground="White" 
                        Style="{StaticResource AccessibleButtonStyle}"
                        TabIndex="1"
                        Margin="0,0,0,15"
                        Command="{Binding LoadStatisticsCommand}"/>

                    <!-- Accommodation List -->
                    <DataGrid ItemsSource="{Binding Accommodations}"
                         SelectedItem="{Binding SelectedAccommodation, Mode=TwoWay}"
                         Style="{StaticResource AccessibleDataGridStyle}"
                         TabIndex="2"
                         Height="460"
                         Margin="0,0,0,15"
                         KeyDown="DataGrid_KeyDown"
                         PreviewKeyDown="DataGrid_PreviewKeyDown">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Accommodation Name" 
                                           Binding="{Binding Name}" 
                                           Width="*" 
                                           FontWeight="Medium"/>
                            <DataGridTextColumn Header="City" 
                                           Binding="{Binding GeoLocation.City}" 
                                           Width="80"/>
                            <DataGridTextColumn Header="Country" 
                                           Binding="{Binding GeoLocation.Country}" 
                                           Width="70"/>
                            <DataGridTextColumn Header="Type" 
                                           Binding="{Binding Type}" 
                                           Width="70"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- PDF Report Button - after table -->
                    <Button Content="Generate PDF Report"
                        Background="#27AE60"
                        Foreground="White"
                        Style="{StaticResource AccessibleButtonStyle}"
                        TabIndex="3"
                        Command="{Binding GeneratePDFReportCommand}"
                        IsEnabled="{Binding HasSelectedAccommodation}"/>
                </StackPanel>
            </Border>

            <!-- Right Panel - Charts and Statistics -->
            <Border Grid.Column="1" 
                Style="{StaticResource CardStyle}" 
                Visibility="{Binding HasSelectedAccommodation, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid KeyboardNavigation.TabNavigation="Local">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="240"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="200"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Chart Title -->
                    <TextBlock Grid.Row="0" 
                           Text="Statistics Over the Years" 
                           Style="{StaticResource SectionTitleStyle}"/>

                    <!-- Main Chart - Yearly Statistics -->
                    <lvc:CartesianChart Grid.Row="1" 
                                   Series="{Binding YearlyChartSeries}"
                                   LegendLocation="Right"
                                   Margin="0,10,0,20"
                                   KeyboardNavigation.IsTabStop="False">
                        <lvc:CartesianChart.AxisX>
                            <lvc:Axis Title="Year" 
                                 Labels="{Binding YearLabels}"
                                 FontSize="12"/>
                        </lvc:CartesianChart.AxisX>
                        <lvc:CartesianChart.AxisY>
                            <lvc:Axis Title="Count"
                                 FontSize="12"
                                 MinValue="0"/>
                        </lvc:CartesianChart.AxisY>
                    </lvc:CartesianChart>

                    <!-- Best Year Info and Year Selection in same row -->
                    <Grid Grid.Row="2" Margin="0,10,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="200"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                               Text="{Binding BestYearText}" 
                               Style="{StaticResource InfoTextStyle}"
                               HorizontalAlignment="Left"
                               VerticalAlignment="Center"/>

                        <TextBlock Grid.Column="1" 
                               Text="Choose year:" 
                               FontSize="16"
                               Foreground="#2C3E50"
                               HorizontalAlignment="Right"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>

                        <ComboBox Grid.Column="2"
                             ItemsSource="{Binding AvailableYears}"
                             SelectedItem="{Binding SelectedYear, Mode=TwoWay}"
                             Style="{StaticResource AccessibleComboBoxStyle}"
                             TabIndex="4">
                            <ComboBox.Template>
                                <ControlTemplate TargetType="ComboBox">
                                    <Grid>
                                        <ToggleButton Name="ToggleButton"
                                                 Background="White"
                                                 BorderBrush="#E2E2E2"
                                                 BorderThickness="1"
                                                 IsChecked="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                                 ClickMode="Press"
                                                 KeyboardNavigation.IsTabStop="True"
                                                 TabIndex="4">
                                            <ToggleButton.Template>
                                                <ControlTemplate TargetType="ToggleButton">
                                                    <Border Background="{TemplateBinding Background}"
                                                       BorderBrush="{TemplateBinding BorderBrush}"
                                                       BorderThickness="{TemplateBinding BorderThickness}"
                                                       CornerRadius="4"
                                                       x:Name="Border">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="30"/>
                                                            </Grid.ColumnDefinitions>
                                                            <Path Grid.Column="1"
                                                             Data="M 0 0 L 4 4 L 8 0 Z"
                                                             Fill="#666"
                                                             HorizontalAlignment="Center"
                                                             VerticalAlignment="Center"/>
                                                        </Grid>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsFocused" Value="True">
                                                            <Setter TargetName="Border" Property="BorderBrush" Value="#4A90E2"/>
                                                            <Setter TargetName="Border" Property="BorderThickness" Value="2"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </ToggleButton.Template>
                                        </ToggleButton>
                                        <ContentPresenter Name="ContentSite"
                                                     IsHitTestVisible="False"
                                                     Content="{TemplateBinding SelectionBoxItem}"
                                                     ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                     Margin="8,0,0,0"
                                                     VerticalAlignment="Center"
                                                     HorizontalAlignment="Left"/>
                                        <Popup Name="Popup"
                                          Placement="Bottom"
                                          IsOpen="{TemplateBinding IsDropDownOpen}"
                                          AllowsTransparency="True"
                                          Focusable="False"
                                          PopupAnimation="Slide">
                                            <Grid Name="DropDown"
                                             SnapsToDevicePixels="True"
                                             MinWidth="{TemplateBinding ActualWidth}"
                                             MaxHeight="150">
                                                <Border Background="White"
                                                   BorderBrush="#E2E2E2"
                                                   BorderThickness="1"
                                                   CornerRadius="4"/>
                                                <ScrollViewer Margin="2" SnapsToDevicePixels="True">
                                                    <StackPanel IsItemsHost="True" 
                                                           KeyboardNavigation.DirectionalNavigation="Contained"/>
                                                </ScrollViewer>
                                            </Grid>
                                        </Popup>
                                    </Grid>
                                </ControlTemplate>
                            </ComboBox.Template>
                        </ComboBox>
                    </Grid>

                    <!-- Monthly Chart (when year is selected) -->
                    <lvc:CartesianChart Grid.Row="3" 
                                   Series="{Binding MonthlyChartSeries}"
                                   LegendLocation="Right"
                                   Visibility="{Binding ShowMonthlyChart, Converter={StaticResource BooleanToVisibilityConverter}}"
                                   KeyboardNavigation.IsTabStop="False">
                        <lvc:CartesianChart.AxisX>
                            <lvc:Axis Title="Month" 
                                 Labels="{Binding MonthLabels}"
                                 FontSize="12"/>
                        </lvc:CartesianChart.AxisX>
                        <lvc:CartesianChart.AxisY>
                            <lvc:Axis Title="Count"
                                 FontSize="12"
                                 MinValue="0"/>
                        </lvc:CartesianChart.AxisY>
                    </lvc:CartesianChart>

                    <!-- Best Month Info -->
                    <TextBlock Grid.Row="4" 
                           Text="{Binding BestMonthText}" 
                           Style="{StaticResource InfoTextStyle}"
                           Margin="0,10,0,0"
                           Visibility="{Binding ShowMonthlyChart, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                </Grid>
            </Border>
        </Grid>
    </ScrollViewer>
</UserControl>