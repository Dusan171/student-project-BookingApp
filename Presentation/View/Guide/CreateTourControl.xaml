<Page x:Class="BookingApp.Presentation.View.Guide.CreateTourControl"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:util="clr-namespace:BookingApp.Utilities"
      xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
      xmlns:controls="clr-namespace:BookingApp.Presentation.View.Guide.Controls"
      Background="#FFF5F5F5">

    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/CreateTourStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <util:BooleanToVisibilityConverter x:Key="BoolToVis"/>
        </ResourceDictionary>
    </Page.Resources>

    <Grid>
        <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="15" Orientation="Vertical">
                <TextBlock Text="Create a New Tour" FontSize="22" FontWeight="Bold" Foreground="#333333" HorizontalAlignment="Left" Margin="0,0,0,12"/>

                <!-- Basic Info Section -->
                <controls:BasicInfoControl DataContext="{Binding}"/>

                <!-- Start Times Section -->
                <controls:StartTimesControl DataContext="{Binding}"/>

                <!-- Duration -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <Label Content="Duration (h):" Width="100"/>
                    <xctk:IntegerUpDown Value="{Binding Duration, UpdateSourceTrigger=PropertyChanged}" Minimum="1" Maximum="100" Width="70" Height="30" ToolTip="Enter the duration of the tour in hours"/>
                </StackPanel>

                <!-- Key Points -->
                <GroupBox Header="Key Points" Margin="0,5,0,10" FontWeight="Bold" ToolTip="Add important locations or notes for the tour">
                    <StackPanel Margin="5">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBox Text="{Binding KeyPointInput}" Height="30" Width="150" HorizontalAlignment="Stretch" Margin="0,0,5,0" ToolTip="Enter a new key point"/>
                            <Button Content="Add" Width="60" Margin="0,0,5,0" Command="{Binding AddKeyPointCommand}" Background="#4CAF50" Foreground="White" BorderThickness="0" Style="{StaticResource AnimatedButtonStyle}" ToolTip="Add this key point"/>
                            <Button Content="Remove" Width="70" Command="{Binding RemoveKeyPointCommand}" CommandParameter="{Binding SelectedItem, ElementName=KeyPointsList}" Background="#F44336" Foreground="White" BorderThickness="0" Style="{StaticResource AnimatedButtonStyle}" ToolTip="Remove the selected key point"/>
                        </StackPanel>
                        <ListBox x:Name="KeyPointsList" ItemsSource="{Binding KeyPoints}" SelectedItem="{Binding SelectedKeyPoint}" Height="50" HorizontalAlignment="Stretch" ItemContainerStyle="{StaticResource AnimatedListBoxItemStyle}" ToolTip="List of all key points"/>
                    </StackPanel>
                </GroupBox>

                <!-- Images Section -->
                <controls:ImageManagerControl DataContext="{Binding}"/>

                <!-- Action Buttons -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,15,0,10">
                    <Button Content="Create" Width="100" Margin="5" Command="{Binding CreateTourCommand}" Background="#007ACC" Foreground="White" BorderThickness="0" Height="35" Style="{StaticResource AnimatedButtonStyle}" ToolTip="Create this tour"/>
                    <Button Content="Cancel" Width="100" Margin="5" Command="{Binding CancelCommand}" Background="#9E9E9E" Foreground="White" BorderThickness="0" Height="35" Style="{StaticResource AnimatedButtonStyle}" ToolTip="Cancel and go back"/>
                </StackPanel>

            </StackPanel>
        </ScrollViewer>

        <!-- Image Viewer Overlay -->
        <Grid Background="#80000000" Visibility="{Binding IsImageViewerVisible, Converter={StaticResource BoolToVis}}" Margin="0" ToolTip="Image viewer mode">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="50"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="50"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="50"/>
            </Grid.RowDefinitions>

            <Button Grid.Row="0" Grid.Column="2" Content="X" FontSize="18" Width="35" Height="35" Margin="5" HorizontalAlignment="Right" VerticalAlignment="Top" Command="{Binding CloseImageViewerCommand}" Background="#F44336" Foreground="White" BorderThickness="0" Style="{StaticResource AnimatedButtonStyle}" ToolTip="Close viewer"/>
            <Button Grid.Column="0" Content="◀" FontSize="30" Command="{Binding PreviousImageCommand}" VerticalAlignment="Center" Background="Transparent" Foreground="White" BorderThickness="0" ToolTip="Previous image"/>
            <Image Grid.Column="1" Source="{Binding CurrentImage.FullPath}" Stretch="Uniform" VerticalAlignment="Center" HorizontalAlignment="Center" ToolTip="Current image"/>
            <Button Grid.Column="2" Content="▶" FontSize="30" Command="{Binding NextImageCommand}" VerticalAlignment="Center" Background="Transparent" Foreground="White" BorderThickness="0" ToolTip="Next image"/>
            <Button Grid.Row="1" Grid.Column="1" Content="Remove" Width="100" Command="{Binding RemoveCurrentImageCommand}" HorizontalAlignment="Center" Background="#F44336" Foreground="White" BorderThickness="0" Style="{StaticResource AnimatedButtonStyle}" ToolTip="Remove this image"/>
        </Grid>

    </Grid>
</Page>
