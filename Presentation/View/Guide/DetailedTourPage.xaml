<Page x:Class="BookingApp.Presentation.View.Guide.DetailedTourPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:util="clr-namespace:BookingApp.Utilities"
      Background="White">
    <Page.Resources>
        <util:BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Page.Resources>

    <Grid>
        <ScrollViewer>
            <StackPanel Margin="25" HorizontalAlignment="Left" Width="420">

                <!-- Tour Name -->
                <TextBlock Text="{Binding Tour.Name}" 
                           FontSize="26" FontWeight="Bold" 
                           TextAlignment="Left" 
                           Margin="0,0,0,15"/>

                <!-- Description -->
                <TextBlock Text="{Binding Tour.Description}" 
                           TextWrapping="Wrap" 
                           FontSize="15" 
                           Margin="0,0,0,25"/>

                <!-- Location -->
                <StackPanel Orientation="Horizontal" Margin="0,5">
                    <TextBlock Text="Location:" FontWeight="Bold" FontSize="15" Width="120"/>
                    <TextBlock FontSize="15">
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0}, {1}">
                                <Binding Path="Tour.Location.City"/>
                                <Binding Path="Tour.Location.Country"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>

                <!-- Info -->
                <StackPanel Orientation="Horizontal" Margin="0,5">
                    <TextBlock Text="Language:" FontWeight="Bold" Width="120" FontSize="15"/>
                    <TextBlock Text="{Binding Tour.Language}" FontSize="15"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,5">
                    <TextBlock Text="Max Tourists:" FontWeight="Bold" Width="120" FontSize="15"/>
                    <TextBlock Text="{Binding Tour.MaxTourists}" FontSize="15"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,5">
                    <TextBlock Text="Reserved Spots:" FontWeight="Bold" Width="120" FontSize="15"/>
                    <TextBlock Text="{Binding Tour.ReservedSpots}" FontSize="15"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,5">
                    <TextBlock Text="Duration (hours):" FontWeight="Bold" Width="120" FontSize="15"/>
                    <TextBlock Text="{Binding Tour.DurationHours}" FontSize="15"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,5">
                    <TextBlock Text="Status:" FontWeight="Bold" Width="120" FontSize="15"/>
                    <TextBlock Text="{Binding Tour.Status}" FontSize="15"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,5">
                    <TextBlock Text="Guide:" FontWeight="Bold" Width="120" FontSize="15"/>
                    <TextBlock Text="{Binding GuideName}" FontSize="15"/>
                </StackPanel>

                <!-- Start Times -->
                <TextBlock Text="Available Start Times:" 
                           FontSize="14" FontWeight="Bold" 
                           Margin="0,20,0,8"/>
                <ItemsControl ItemsSource="{Binding StartTimes}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Time}" FontSize="14" Margin="10,3,0,3"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Key Points -->
                <TextBlock Text="Key Points:" 
                           FontSize="14" FontWeight="Bold" 
                           Margin="0,20,0,8"/>
                <ItemsControl ItemsSource="{Binding KeyPoints}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}" FontSize="14" Margin="10,3,0,3"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Images -->
                <TextBlock Text="Images:" 
                           FontSize="14" FontWeight="Bold" 
                           Margin="0,20,0,8"/>
                <ListBox ItemsSource="{Binding Images}" Height="160" HorizontalAlignment="Stretch" SelectionMode="Single">
                    <ListBox.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ListBox.ItemsPanel>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Image Source="{Binding FullPath}" Width="80" Height="80" Margin="6">
                                <Image.ToolTip>
                                    <ToolTip Content="Double click to preview this image" 
                                             FontSize="13"/>
                                </Image.ToolTip>
                                <Image.InputBindings>
                                    <MouseBinding MouseAction="LeftDoubleClick"
                                                  Command="{Binding DataContext.OpenImageCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                  CommandParameter="{Binding}"/>
                                </Image.InputBindings>
                            </Image>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>
        </ScrollViewer>

        <!-- IMAGE OVERLAY -->
        <Border Background="#CC000000"
                Visibility="{Binding IsOverlayVisible, Converter={StaticResource BoolToVisibilityConverter}}"
                Panel.ZIndex="1000">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="50"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="50"/>
                </Grid.ColumnDefinitions>

                <!-- Left arrow -->
                <Button Content="⟨" FontSize="30" Width="40" Height="40" 
                        VerticalAlignment="Center" 
                        Command="{Binding PrevImageCommand}"
                        Background="Transparent" Foreground="White" BorderThickness="0"
                        Grid.Column="0"
                        ToolTip="Previous image"/>

                <!-- Big image -->
                <Image Source="{Binding LargeImage}" 
                       Stretch="Uniform" Grid.Column="1" 
                       ToolTip="Image preview"/>

                <!-- Right arrow -->
                <Button Content="⟩" FontSize="30" Width="40" Height="40" 
                        VerticalAlignment="Center" 
                        Command="{Binding NextImageCommand}"
                        Background="Transparent" Foreground="White" BorderThickness="0"
                        Grid.Column="2"
                        ToolTip="Next image"/>

                <!-- Close button -->
                <Button Content="X" FontSize="16" Width="35" Height="35"
                        HorizontalAlignment="Right" VerticalAlignment="Top" Margin="10"
                        Command="{Binding CloseOverlayCommand}"
                        Background="Transparent" Foreground="White" BorderThickness="0"
                        ToolTip="Close preview"/>
            </Grid>
        </Border>
    </Grid>
</Page>
