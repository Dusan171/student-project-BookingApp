<UserControl x:Class="BookingApp.Presentation.View.Guest.MyReservationsPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:utilities="clr-namespace:BookingApp.Utilities"
             xmlns:loc="clr-namespace:BookingApp.Utilities"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000"
             Background="{DynamicResource PrimaryBackgroundColor}">

    <UserControl.Resources>
        <utilities:StringToVisibilityConverter x:Key="StringToVisibility"/>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="{loc:Translate MyReservations_Title}" FontSize="32" FontWeight="Bold" Margin="20" 
                   Foreground="{DynamicResource PrimaryTextColor}"/>

        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" Margin="10,0,10,10">
                <ListView ItemsSource="{Binding Reservations}" BorderThickness="0" Background="Transparent"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled">

                    <ListView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                        </ItemsPanelTemplate>
                    </ListView.ItemsPanel>

                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="Focusable" Value="False"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListViewItem">
                                        <ContentPresenter/>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListView.ItemContainerStyle>

                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Background="{DynamicResource SecondaryBackgroundColor}" CornerRadius="8" Width="420"
                                    BorderBrush="{DynamicResource BorderColor}" BorderThickness="1" Margin="10" Padding="20">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <StackPanel Grid.Row="0" Margin="0,0,0,20">
                                        <TextBlock Text="{Binding AccommodationName}" FontSize="22" FontWeight="Bold" 
                                                   Foreground="{DynamicResource PrimaryTextColor}" TextWrapping="Wrap"/>
                                        <TextBlock FontSize="16" Foreground="{DynamicResource SecondaryTextColor}" Margin="0,5,0,0">
                                            <Run Text="{Binding StartDate, StringFormat='dd.MM.yyyy'}"/> - <Run Text="{Binding EndDate, StringFormat='dd.MM.yyyy'}"/>
                                        </TextBlock>

                                        <TextBlock FontSize="16" Foreground="{DynamicResource SecondaryTextColor}" Margin="0,5,0,15">
                                            <Run Text="{loc:Translate MyReservations_GuestsLabel}"/>
                                            <Run Text="{Binding GuestsNumber}"/>
                                        </TextBlock>

                                        <Border Background="{DynamicResource PrimaryBackgroundColor}" CornerRadius="5" Padding="10" 
                                                Visibility="{Binding RequestStatusText, Converter={StaticResource StringToVisibility}}">
                                            <StackPanel>
                                                <TextBlock FontWeight="Bold" Foreground="{DynamicResource PrimaryTextColor}" FontSize="16" 
                                                           Text="{loc:Translate MyReservations_RescheduleRequest}"/>
                                                <TextBlock Text="{Binding RequestStatusText}" FontStyle="Italic" Foreground="{DynamicResource SecondaryTextColor}" FontSize="16"/>
                                                <TextBlock Text="{Binding OwnerComment}" Foreground="{DynamicResource WarningTextColor}" Margin="0,5,0,0" TextWrapping="Wrap" FontSize="16"
                                                           Visibility="{Binding OwnerComment, Converter={StaticResource StringToVisibility}}"/>
                                            </StackPanel>
                                        </Border>
                                    </StackPanel>

                                    <WrapPanel Grid.Row="1" HorizontalAlignment="Right">
                                        <Button Content="{loc:Translate MyReservations_Cancel}" Style="{StaticResource DangerButton}" Margin="5"
                                                Visibility="{Binding IsCancellationEnabled, Converter={StaticResource BoolToVisibility}}"
                                                Command="{Binding DataContext.CancelReservationCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                CommandParameter="{Binding}"/>
                                        <Button Content="{loc:Translate MyReservations_Reschedule}" Style="{StaticResource PrimaryButton}" Margin="5"
                                                Visibility="{Binding IsRescheduleEnabled, Converter={StaticResource BoolToVisibility}}"
                                                Command="{Binding DataContext.RescheduleCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                CommandParameter="{Binding}"/>
                                        <Button Content="{loc:Translate MyReservations_Rate}" Style="{StaticResource PrimaryButton}" Margin="5"
                                                Visibility="{Binding IsRatingEnabled, Converter={StaticResource BoolToVisibility}}"
                                                Command="{Binding DataContext.RateCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                CommandParameter="{Binding}"/>
                                        <Button Content="{loc:Translate MyReservations_ViewReview}" Style="{StaticResource SecondaryButton}" Margin="5"
                                                Visibility="{Binding IsGuestReviewVisible, Converter={StaticResource BoolToVisibility}}"
                                                Command="{Binding DataContext.ViewReviewCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                CommandParameter="{Binding}"/>
                                    </WrapPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </ScrollViewer>

            <StackPanel Grid.Row="1" VerticalAlignment="Bottom">
                <Separator Style="{StaticResource GuestSeparatorStyle}" Margin="20,10"/>

                <GroupBox Header="{loc:Translate MyReservations_ReportSection}" 
                          Style="{StaticResource GuestGroupBoxStyle}" Margin="20,0,20,20" Padding="10">
                    <WrapPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                        <StackPanel Margin="10,5">
                            <TextBlock Text="{loc:Translate MyReservations_ReportStart}" Foreground="{DynamicResource SecondaryTextColor}" FontSize="14" Margin="0,0,0,5"/>
                            <DatePicker SelectedDate="{Binding ReportStartDate}" Style="{StaticResource GuestDatePickerStyle}" MinWidth="170"/>
                        </StackPanel>

                        <StackPanel Margin="10,5">
                            <TextBlock Text="{loc:Translate MyReservations_ReportEnd}" Foreground="{DynamicResource SecondaryTextColor}" FontSize="14" Margin="0,0,0,5"/>
                            <DatePicker SelectedDate="{Binding ReportEndDate}" Style="{StaticResource GuestDatePickerStyle}" MinWidth="170"/>
                        </StackPanel>

                        <Button Content="{loc:Translate MyReservations_ReportGenerate}" Style="{StaticResource SuccessButton}" 
                                Command="{Binding GenerateReportCommand}" VerticalAlignment="Bottom" Margin="10,5"/>
                    </WrapPanel>
                </GroupBox>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>